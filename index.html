<?php
// Базовая директория — ограничиваемся текущей директорией скрипта
$baseDir = realpath(__DIR__);

// Опционально: выбрать поддиректорию через GET, но только из белого списка
$allowed = ['.', 'files', 'uploads']; // добавьте допустимые подпапки
$requested = isset($_GET['dir']) ? $_GET['dir'] : '.';
$dir = in_array($requested, $allowed, true) ? $requested : '.';

// Собираем реальный путь и проверяем, что он внутри $baseDir
$fullPath = realpath($baseDir . DIRECTORY_SEPARATOR . $dir);
if ($fullPath === false || strpos($fullPath, $baseDir) !== 0) {
    http_response_code(400);
    echo "Invalid directory";
    exit;
}

// Получаем список файлов
$items = scandir($fullPath);
if ($items === false) {
    http_response_code(500);
    echo "Cannot read directory";
    exit;
}

// Вывод в браузер — экранируем имена файлов
header('Content-Type: text/html; charset=utf-8');
echo "<h2>Listing of " . htmlspecialchars($dir, ENT_QUOTES, 'UTF-8') . "</h2><ul>";
foreach ($items as $item) {
    if ($item === '.' || $item === '..') continue;
    echo "<li>" . htmlspecialchars($item, ENT_QUOTES, 'UTF-8') . "</li>";
}
echo "</ul>";
